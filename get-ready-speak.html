<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile-Wise AI - Instant Speech Ready</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }

        .message {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .user-message {
            background: rgba(76, 175, 80, 0.3);
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .ai-message {
            background: rgba(33, 150, 243, 0.3);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        /* SPEECH READY UI - CRITICAL STYLING */
        #liveTranscript {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 20px 30px;
            text-align: center;
            backdrop-filter: blur(15px);
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.4);
            z-index: 1000;
            display: none;
            min-width: 250px;
            transition: all 0.3s ease;
        }

        #transcriptText {
            color: #ffffff;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
            animation: pulseGlow 2s ease-in-out infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { 
                text-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 
                           0 0 25px rgba(255, 255, 255, 0.6);
            }
            50% { 
                text-shadow: 0 0 20px rgba(0, 255, 136, 0.9),
                           0 0 35px rgba(0, 255, 136, 0.7),
                           0 0 45px rgba(0, 255, 136, 0.5);
            }
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .mic-btn.listening {
            background: rgba(76, 175, 80, 0.5);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Mobile-specific optimizations */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            #liveTranscript {
                bottom: 80px;
                min-width: 200px;
                padding: 15px 25px;
            }
            
            #transcriptText {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chat-messages" id="chatMessages">
            <div class="message ai-message">
                Hi! I'm Bruce's AI assistant. Click the microphone to start talking!
            </div>
        </div>
        
        <div class="controls">
            <button id="micButton" class="mic-btn" onclick="activateMicrophone()">
                ðŸŽ¤ Start Voice Chat
            </button>
            <button onclick="testInstantReady()">
                ðŸ”¥ Test Instant Ready
            </button>
        </div>
    </div>

    <!-- SPEECH READY UI -->
    <div id="liveTranscript">
        <div id="transcriptText">Get Ready to Speak</div>
    </div>

    <script>
        // ===================================================
        // ðŸŽ¯ MOBILE-WISE AI INSTANT SPEECH READY SYSTEM
        // ===================================================
        let recognition = null;
        let isListening = false;
        let isSpeaking = false;
        let isAudioMode = false;

        // Detect mobile device
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // ðŸš€ INSTANT SPEECH READY SYSTEM
        function showInstantSpeechReady() {
            console.log('ðŸš€ Showing instant speech ready UI');
            
            const liveTranscript = document.getElementById('liveTranscript');
            const transcriptText = document.getElementById('transcriptText');
            
            if (!liveTranscript || !transcriptText) {
                console.error('âŒ Missing speech UI elements');
                return;
            }
            
            // INSTANT VISUAL - Show immediately (no delay)
            liveTranscript.style.display = 'block';
            transcriptText.style.display = 'block';
            
            // PHASE 1: "GET READY TO SPEAK" (Instant)
            transcriptText.textContent = 'Get Ready to Speak';
            transcriptText.style.color = '#ffffff';
            transcriptText.style.fontWeight = 'bold';
            transcriptText.style.fontSize = '18px';
            
            // Clean transparent look with subtle glow
            liveTranscript.style.background = 'rgba(255, 255, 255, 0.15)';
            liveTranscript.style.border = '2px solid rgba(255, 255, 255, 0.3)';
            liveTranscript.style.boxShadow = '0 0 25px rgba(255, 255, 255, 0.4)';
            
            // PRE-WARM ENGINE IMMEDIATELY 
            preWarmSpeechEngine();
            
            // PHASE 2: Switch to "LISTENING" after engine is warm
            setTimeout(() => {
                if (transcriptText) {
                    transcriptText.textContent = 'Listening...';
                    transcriptText.style.color = '#00ff88';
                    
                    liveTranscript.style.boxShadow = '0 0 25px rgba(0, 255, 136, 0.6)';
                    liveTranscript.style.border = '2px solid rgba(0, 255, 136, 0.5)';
                    
                    // ðŸŽ¯ CRITICAL: Actually start listening now
                    startRealListening();
                }
            }, 800);
        }

        // ðŸ”¥ PRE-WARM ENGINE (SILENT - NO BEEP)
        function preWarmSpeechEngine() {
            console.log('ðŸ”¥ Pre-warming speech engine...');
            
            if (!recognition) {
                initializeSpeechRecognition();
            }
            
            // Mobile-specific optimizations
            if (isMobileDevice()) {
                try {
                    // ðŸš« CRITICAL: Turn off browser beep by removing event handlers
                    recognition.onsoundstart = null;
                    recognition.onaudiostart = null;
                    recognition.onstart = null;
                    
                    recognition.start();
                    
                    // Stop immediately - just warming the engine
                    setTimeout(() => {
                        if (recognition && isListening) {
                            recognition.stop();
                            isListening = false;
                            console.log('âœ… Speech engine pre-warmed');
                        }
                    }, 100);
                } catch (error) {
                    console.log('ðŸ”§ Engine already warming:', error.message);
                }
            }
        }

        // ðŸŽ¤ REAL LISTENING AFTER PRE-WARM
        function startRealListening() {
            console.log('ðŸŽ¤ Starting real listening...');
            
            if (!recognition) {
                initializeSpeechRecognition();
            }
            
            try {
                // ðŸš« TURN OFF ALL BROWSER BEEPS
                recognition.onsoundstart = null;
                recognition.onaudiostart = null;
                recognition.onstart = null;
                
                recognition.onresult = function(event) {
                    const transcript = Array.from(event.results)
                        .map(result => result[0])
                        .map(result => result.transcript)
                        .join('');
                    
                    console.log('ðŸŽ¯ User said:', transcript);
                    addAIMessage("I heard: " + transcript);
                };
                
                recognition.onend = function() {
                    console.log('ðŸ”š Recognition ended');
                    isListening = false;
                    
                    // Auto-restart if in audio mode
                    if (isAudioMode && !isSpeaking) {
                        setTimeout(() => {
                            showInstantSpeechReady();
                        }, 500);
                    }
                };
                
                recognition.onerror = function(event) {
                    console.log('âŒ Recognition error:', event.error);
                    isListening = false;
                };
                
                recognition.start();
                isListening = true;
                console.log('âœ… Real listening started');
                
            } catch (error) {
                console.error('âŒ Error starting recognition:', error);
            }
        }

        // ðŸŽ¤ INITIALIZE SPEECH RECOGNITION
        function initializeSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                console.log('âŒ Speech recognition not supported');
                return false;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            
            // ðŸš« CRITICAL: DISABLE BROWSER BEEP
            recognition.onsoundstart = null;
            recognition.onaudiostart = null;
            recognition.onstart = null;
            
            console.log('âœ… Speech recognition initialized');
            return true;
        }

        // ðŸŽ¤ ACTIVATE MICROPHONE
        async function activateMicrophone() {
            console.log('ðŸŽ¤ Activating microphone...');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // Clean up stream immediately
                stream.getTracks().forEach(track => track.stop());
                
                // Success - switch to audio mode
                isAudioMode = true;
                micPermissionGranted = true;
                
                const micButton = document.getElementById('micButton');
                if (micButton) {
                    micButton.classList.add('listening');
                    micButton.textContent = 'ðŸŽ¤ Listening...';
                }
                
                // Add welcome message
                addAIMessage("Microphone activated! I'm ready to help you.");
                
                // ðŸŽ¯ CRITICAL: Show instant ready UI immediately
                setTimeout(() => {
                    showInstantSpeechReady();
                }, 500);
                
            } catch (error) {
                console.error('âŒ Microphone access denied:', error);
                addAIMessage("Microphone access was denied. Please allow microphone permissions.");
            }
        }

        // ðŸ§ª TEST FUNCTION
        function testInstantReady() {
            console.log('ðŸ§ª Testing instant ready system...');
            addAIMessage("Testing instant speech ready system...");
            showInstantSpeechReady();
        }

        // ðŸ’¬ MESSAGE FUNCTIONS
        function addAIMessage(message) {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            const messageElement = document.createElement('div');
            messageElement.className = 'message ai-message';
            messageElement.textContent = message;
            
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        // ðŸŽ¯ DEMO: Simulate AI response ending (like your real system)
        function simulateAIResponse() {
            addAIMessage("This is a simulated AI response. After this, the 'Get Ready to Speak' should appear instantly.");
            
            // Simulate AI speaking time
            setTimeout(() => {
                console.log('ðŸ”Š AI finished speaking - showing instant ready UI');
                showInstantSpeechReady();
            }, 2000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Mobile-Wise AI Instant Ready System Loaded');
            console.log('ðŸ“± Mobile Device:', isMobileDevice());
            
            // Add test button functionality
            setTimeout(() => {
                addAIMessage("Click 'Test Instant Ready' to see the new system in action!");
            }, 1000);
        });

        // ðŸŽ¯ ADD TEST BUTTON TO UI
        setTimeout(() => {
            const controls = document.querySelector('.controls');
            if (controls) {
                const testBtn = document.createElement('button');
                testBtn.textContent = 'ðŸ§ª Simulate AI End';
                testBtn.onclick = simulateAIResponse;
                controls.appendChild(testBtn);
            }
        }, 500);

    </script>
</body>
</html>